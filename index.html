<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Дні народження</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
</head>
<body>
<div class="container mt-5">
  <table class="table table-bordered" id="data-table">
    <thead>
      <tr>
      </tr>
    </thead>
    <tbody class="table-group-divider">
    </tbody>
  </table>
  <form class="row mb-3">
    <div class="col-auto flex-grow-1 mb-3">
      <textarea class="form-control" type="url" name="url-input" id="urlInput" placeholder="https://docs.google.com/spreadsheets/....."></textarea>
    </div>
    <div class="col-auto">
      <button type="button" onclick="getAndShowData()" class="btn btn-dark">Застосувати</button>
    </div>
  </form>
</div>

<script type="text/javascript">
    async function getAndShowData() {
      const url = document.getElementById("urlInput").value;

      document.cookie = "url="+document.getElementById("urlInput").value+"; path=/"; 

      const response = await fetch(url);
      const result = await response.text();
      const finalResult = result.split("\r\n").map(row => row.split(","));
      const tableBody = document.querySelector('#data-table tbody');
      tableBody.innerHTML = "";
      const tableHeader = document.querySelector('#data-table thead');
      tableHeader.innerHTML = "";
      
      const header = finalResult[0];
        const tr = document.createElement('tr');
        header.forEach(cell => {
          const th = document.createElement('th');
          th.textContent = cell.trim();
          tr.appendChild(th);
        });
        tableHeader.appendChild(tr);

      todayTime = new Date()
      todayDate = todayTime.getDate()
      todayMonth = todayTime.getMonth()+1

      finalResult.slice(1).forEach(row => {
        const tr = document.createElement('tr');
        row.forEach(cell => {
          const td = document.createElement('td');
          td.textContent = cell.trim();
          tr.appendChild(td);
          tr.lastChild.innerHTML.split(".").pop()
        });
        splittedTrLastChildInnerHTML = tr.lastChild.innerHTML.split(".")
        if (todayDate == splittedTrLastChildInnerHTML[0] && todayMonth == splittedTrLastChildInnerHTML[1]){
          tr.classList.add('table-success');
          const jsConfetti = new JSConfetti();
          jsConfetti.addConfetti();
        }
        tableBody.appendChild(tr);
    });
  }
  if (document.cookie != ""){
    document.getElementById("urlInput").value = document.cookie.split("; ").find((row) => row.startsWith("url="))?.split("=")[1] + "=csv";
  }
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/js-confetti@latest/dist/js-confetti.browser.js"></script>
</body>
</html>